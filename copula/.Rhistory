for (mi in 1:length(mts)){
print(sprintf('%d, %d,%d', ri, vegi, mi))
te = RVinePIT(fff[,1:3],cvine[[vegi, mi]])[,1]
tid = heat1[[vegi,mi]]$idbest
thhh = getinvmarginal(fff[,2], heat1[[vegi, mi]]$pars[[tid]], heat1[[vegi, mi]]$distnames[tid])
tid = dry1[[vegi,mi]]$idbest
tddd = getinvmarginal(fff[,3], dry1[[vegi, mi]]$pars[[tid]], dry1[[vegi, mi]]$distnames[tid])
tf = data.frame(gpp = te, H = thhh, D = tddd)
tf = tf[colMeans(t(is.infinite(as.matrix(tf))))==0,]
cpl[[vegi, mi]] = interp(tf$H, tf$D, tf$gpp, nx = 500, ny = 500)
}
}
cpls[[ri]] = cpl
}
for (ri in 1:length(ratio)){
nms_veg = c("forest","open forest","shrub land","paddy field","dry land","grassland")
png(filename = sprintf('./cpl_spatial_%.2f.jpg', ratio[ri]),width = 1920, height = 1080, units = "px",
bg = "transparent",  res = NA)
library(fields)
# library(RColorBrewer)
set.panel()
ind <- split.screen(c(6,nmts))
for(ii in 1:length(ind)){
vegi = ceiling(ii /nmts)
mi = mod0(ii, nmts)
print(sprintf('%d,%d', vegi, mi))
if (vegi == 1){
tmain = sprintf("month = %d", mts[mi])
} else {
tmain = "";
}
if (mi == 1){
tylb = nms_veg[vegi]
} else {
tylb = "p-pet"
}
Fdata <- cpls[[ri]][[vegi, mi]]
screen(ind[ii])
image.plot(Fdata$x,Fdata$y,Fdata$z,main=tmain,cex.main=3,xlab="tmax",ylab= tylb,
axes=F,col =tim.colors(20),axis.args = list(cex.axis=2),
legend.args=list( text=""),smallplot=c(0.85,0.9,0.1,0.9)
)
}
close.screen(all=TRUE);
dev.off();
}
save(cpls, file = './copula_spatial_plotdata.RData')
###################
library(akima)
library(fields)
sss = seq(0,1,0.01)
nsss = length(sss)
msh = meshgrid(sss)
###################
library(akima)
library(fields)
sss0 = seq(0,1,0.05)
nsss0 = length(sss0)
msh0 = meshgrid(sss0)
sss = seq(0,1,0.01)
nsss = length(sss)
msh = meshgrid(sss)
fff<-matrix(0,nsss0*nsss0,4)
fff
###################
library(akima)
library(fields)
sss0 = seq(0,1,0.05)
nsss0 = length(sss0)
msh0 = meshgrid(sss0)
msh0
cpl
cpl[[1,1]]
cpl[[1,1]]$x
cpl[[1,1]]$y
tf
nsss0
nsss0*nsss0
tfff = matrix(0, nsss * nsss, 4)
xi = 1
tfff = matrix(0, nsss, 4)
tfff[,2] = fff[xi, 2]
tfff[,3] = fff[xi, 3]
tfff[,1] = sss
tfff
te = RVinePDF(tfff[,1:3],cvine[[vegi, mi]])
te
plot(te)
max(te)
te = RVinePDF(jitter(tfff[,1:3]),cvine[[vegi, mi]])
te = RVinePDF(tfff[,1:3],cvine[[vegi, mi]])
te
max(te)
which(max(te) == te)
sss[which(max(te) == te)]
for (xi in 1:nsss){
tfff = matrix(0, nsss, 4)
tfff[,2] = fff[xi, 2]
tfff[,3] = fff[xi, 3]
tfff[,1] = sss
te = RVinePDF(tfff[,1:3],cvine[[vegi, mi]])
fff[,4] = mean(sss[which(max(te) == te)])
}
fff
plot(fff[,4])
xi
tfff
fff[,2]
fff[,3]
###################
library(akima)
library(fields)
sss0 = seq(0,1,0.05)
nsss0 = length(sss0)
msh0 = meshgrid(sss0)
sss = seq(0,1,0.01)
nsss = length(sss)
msh = meshgrid(sss)
fff<-matrix(0,nsss0*nsss0,4)
fff[,2] = matrix(msh0$X, ,1)
fff[,3] = matrix(msh0$Y, ,1)
cpl = matrix(list(), 6,nmts)
cpl2 = matrix(list(), 6,nmts)
for (vegi in 1:6){
for (mi in 1:length(mts)){
print(sprintf('%d, %d,%d', ri, vegi, mi))
for (xi in 1:nsss){
tfff = matrix(0, nsss, 4)
tfff[,2] = fff[xi, 2]
tfff[,3] = fff[xi, 3]
tfff[,1] = sss
te = RVinePDF(tfff[,1:3],cvine[[vegi, mi]])
fff[,4] = mean(sss[which(max(te) == te)])
}
tid = heat1[[vegi,mi]]$idbest
thhh = getinvmarginal(fff[,2], heat1[[vegi, mi]]$pars[[tid]], heat1[[vegi, mi]]$distnames[tid])
tid = dry1[[vegi,mi]]$idbest
tddd = getinvmarginal(fff[,3], dry1[[vegi, mi]]$pars[[tid]], dry1[[vegi, mi]]$distnames[tid])
tf = data.frame(gpp = fff[,4], H = thhh, D = tddd)
tf = tf[colMeans(t(is.infinite(as.matrix(tf))))==0,]
cpl2[[vegi, mi]] = interp(tf$H, tf$D, tf$gpp, nx = 500, ny = 500)
}
}
cpl2
cpl2[[1]]
image(cpl2[[1]])
sss
sss0
{
nms_veg = c("forest","open forest","shrub land","paddy field","dry land","grassland")
png(filename = sprintf('./cpl_spatial_gpp.jpg'),width = 1920, height = 1080, units = "px",
bg = "transparent",  res = NA)
library(fields)
# library(RColorBrewer)
set.panel()
ind <- split.screen(c(6,nmts))
for(ii in 1:length(ind)){
vegi = ceiling(ii /nmts)
mi = mod0(ii, nmts)
print(sprintf('%d,%d', vegi, mi))
if (vegi == 1){
tmain = sprintf("month = %d", mts[mi])
} else {
tmain = "";
}
if (mi == 1){
tylb = nms_veg[vegi]
} else {
tylb = "p-pet"
}
Fdata <- cpl2[[vegi, mi]]
screen(ind[ii])
image.plot(Fdata$x,Fdata$y,Fdata$z,main=tmain,cex.main=3,xlab="tmax",ylab= tylb,
axes=F,col =tim.colors(20),axis.args = list(cex.axis=2),
legend.args=list( text=""),smallplot=c(0.85,0.9,0.1,0.9)
)
}
close.screen(all=TRUE);
dev.off();
}
nsss0
dim(fff)
dim(fff)[1]
fff
for (xi in 1:dim(fff)[1]){
tfff = matrix(0, nsss, 4)
tfff[,2] = fff[xi, 2]
tfff[,3] = fff[xi, 3]
tfff[,1] = sss
te = RVinePDF(tfff[,1:3],cvine[[vegi, mi]])
fff[,4] = mean(sss[which(max(te) == te)])
}
fff[,4]
fff[xi,2]
fff[xi,3]
sss
cvine
###################
library(akima)
library(fields)
sss0 = seq(0,1,0.05)
nsss0 = length(sss0)
msh0 = meshgrid(sss0)
sss = seq(0,1,0.01)
nsss = length(sss)
msh = meshgrid(sss)
fff<-matrix(0,nsss0*nsss0,4)
fff[,2] = matrix(msh0$X, ,1)
fff[,3] = matrix(msh0$Y, ,1)
cpl2 = matrix(list(), 6,nmts)
for (vegi in 1:6){
for (mi in 1:length(mts)){
print(sprintf('%d, %d,%d', ri, vegi, mi))
for (xi in 1:dim(fff)[1]){
tfff = matrix(0, nsss, 4)
tfff[,2] = fff[xi, 2]
tfff[,3] = fff[xi, 3]
tfff[,1] = sss
te = RVinePDF(tfff[,1:3],cvine[[vegi, mi]])
fff[,4] = mean(sss[max(te) == te])
}
tid = heat1[[vegi,mi]]$idbest
thhh = getinvmarginal(fff[,2], heat1[[vegi, mi]]$pars[[tid]], heat1[[vegi, mi]]$distnames[tid])
tid = dry1[[vegi,mi]]$idbest
tddd = getinvmarginal(fff[,3], dry1[[vegi, mi]]$pars[[tid]], dry1[[vegi, mi]]$distnames[tid])
tf = data.frame(gpp = fff[,4], H = thhh, D = tddd)
tf = tf[colMeans(t(is.infinite(as.matrix(tf))))==0,]
cpl2[[vegi, mi]] = interp(tf$H, tf$D, tf$gpp, nx = 500, ny = 500)
}
}
{
nms_veg = c("forest","open forest","shrub land","paddy field","dry land","grassland")
png(filename = sprintf('./cpl_spatial_gpp.jpg'),width = 1920, height = 1080, units = "px",
bg = "transparent",  res = NA)
library(fields)
# library(RColorBrewer)
set.panel()
ind <- split.screen(c(6,nmts))
for(ii in 1:length(ind)){
vegi = ceiling(ii /nmts)
mi = mod0(ii, nmts)
print(sprintf('%d,%d', vegi, mi))
if (vegi == 1){
tmain = sprintf("month = %d", mts[mi])
} else {
tmain = "";
}
if (mi == 1){
tylb = nms_veg[vegi]
} else {
tylb = "p-pet"
}
Fdata <- cpl2[[vegi, mi]]
screen(ind[ii])
image.plot(Fdata$x,Fdata$y,Fdata$z,main=tmain,cex.main=3,xlab="tmax",ylab= tylb,
axes=F,col =tim.colors(20),axis.args = list(cex.axis=2),
legend.args=list( text=""),smallplot=c(0.85,0.9,0.1,0.9)
)
}
close.screen(all=TRUE);
dev.off();
}
vegi = 6
mi  = 4
print(sprintf('%d,%d', vegi, mi))
fff
xi = 500
tfff = matrix(0, nsss, 4)
tfff[,2] = fff[xi, 2]
tfff[,3] = fff[xi, 3]
tfff
tfff[,2] = fff[xi, 2]
xi
xi = 400
tfff[,2] = fff[xi, 2]
tfff
tfff[,3] = fff[xi, 3]
tffff
tfff
tfff
fff
fff[xi, 3]
xi = 300
tfff[,2] = fff[xi, 2]
tfff[,3] = fff[xi, 3]
tfff
tfff[,1] = sss
tfff
te = RVinePDF(tfff[,1:3],cvine[[vegi, mi]])
te
plot(te)
mean(sss[max(te) == te])
f4 = matrix(0,dim(fff)[1]),1)
for (xi in 1:dim(fff)[1]){
tfff = matrix(0, nsss, 4)
tfff[,2] = fff[xi, 2]
tfff[,3] = fff[xi, 3]
tfff[,1] = sss
te = RVinePDF(tfff[,1:3],cvine[[vegi, mi]])
f4[xi] = mean(sss[max(te) == te])
}
f4 = matrix(0,dim(fff)[1],1)
for (xi in 1:dim(fff)[1]){
tfff = matrix(0, nsss, 4)
tfff[,2] = fff[xi, 2]
tfff[,3] = fff[xi, 3]
tfff[,1] = sss
te = RVinePDF(tfff[,1:3],cvine[[vegi, mi]])
f4[xi] = mean(sss[max(te) == te])
}
f4
plot(sss, f4)
length(f4)
length(sss)
tid = heat1[[vegi,mi]]$idbest
thhh = getinvmarginal(fff[,2], heat1[[vegi, mi]]$pars[[tid]], heat1[[vegi, mi]]$distnames[tid])
tid = dry1[[vegi,mi]]$idbest
tddd = getinvmarginal(fff[,3], dry1[[vegi, mi]]$pars[[tid]], dry1[[vegi, mi]]$distnames[tid])
tf = data.frame(gpp = f4, H = thhh, D = tddd)
tf = tf[colMeans(t(is.infinite(as.matrix(tf))))==0,]
cpl2[[vegi, mi]] = interp(tf$H, tf$D, tf$gpp, nx = 500, ny = 500)
cpl2[[vegi,mi]]
image(cpl2[[vegi,mi]])
image.plot(cpl2[[vegi,mi]])
###################
library(akima)
library(fields)
sss0 = seq(0,1,0.05)
nsss0 = length(sss0)
msh0 = meshgrid(sss0)
sss = seq(0,1,0.01)
nsss = length(sss)
msh = meshgrid(sss)
fff<-matrix(0,nsss0*nsss0,4)
fff[,2] = matrix(msh0$X, ,1)
fff[,3] = matrix(msh0$Y, ,1)
cpl2 = matrix(list(), 6,nmts)
for (vegi in 1:6){
for (mi in 1:length(mts)){
print(sprintf('%d,%d', vegi, mi))
f4 = matrix(0,dim(fff)[1],1)
for (xi in 1:dim(fff)[1]){
tfff = matrix(0, nsss, 4)
tfff[,2] = fff[xi, 2]
tfff[,3] = fff[xi, 3]
tfff[,1] = sss
te = RVinePDF(tfff[,1:3],cvine[[vegi, mi]])
f4[xi] = mean(sss[max(te) == te])
}
tid = heat1[[vegi,mi]]$idbest
thhh = getinvmarginal(fff[,2], heat1[[vegi, mi]]$pars[[tid]], heat1[[vegi, mi]]$distnames[tid])
tid = dry1[[vegi,mi]]$idbest
tddd = getinvmarginal(fff[,3], dry1[[vegi, mi]]$pars[[tid]], dry1[[vegi, mi]]$distnames[tid])
tf = data.frame(gpp = f4, H = thhh, D = tddd)
tf = tf[colMeans(t(is.infinite(as.matrix(tf))))==0,]
cpl2[[vegi, mi]] = interp(tf$H, tf$D, tf$gpp, nx = 500, ny = 500)
}
}
{
nms_veg = c("forest","open forest","shrub land","paddy field","dry land","grassland")
png(filename = sprintf('./cpl_spatial_gpp.jpg'),width = 1920, height = 1080, units = "px",
bg = "transparent",  res = NA)
library(fields)
# library(RColorBrewer)
set.panel()
ind <- split.screen(c(6,nmts))
for(ii in 1:length(ind)){
vegi = ceiling(ii /nmts)
mi = mod0(ii, nmts)
print(sprintf('%d,%d', vegi, mi))
if (vegi == 1){
tmain = sprintf("month = %d", mts[mi])
} else {
tmain = "";
}
if (mi == 1){
tylb = nms_veg[vegi]
} else {
tylb = "p-pet"
}
Fdata <- cpl2[[vegi, mi]]
screen(ind[ii])
image.plot(Fdata$x,Fdata$y,Fdata$z,main=tmain,cex.main=3,xlab="tmax",ylab= tylb,
axes=T,col =tim.colors(20),axis.args = list(cex.axis=2),
legend.args=list( text=""),smallplot=c(0.85,0.9,0.1,0.9)
)
}
close.screen(all=TRUE);
dev.off();
}
{
nms_veg = c("forest","open forest","shrub land","paddy field","dry land","grassland")
png(filename = sprintf('./cpl_spatial_gpp.jpg'),width = 1920, height = 1080, units = "px",
bg = "transparent",  res = NA)
library(fields)
# library(RColorBrewer)
set.panel()
ind <- split.screen(c(6,nmts))
for(ii in 1:length(ind)){
vegi = ceiling(ii /nmts)
mi = mod0(ii, nmts)
print(sprintf('%d,%d', vegi, mi))
if (vegi == 1){
tmain = sprintf("month = %d", mts[mi])
} else {
tmain = "";
}
if (mi == 1){
tylb = nms_veg[vegi]
} else {
tylb = "p-pet"
}
Fdata <- cpl2[[vegi, mi]]
screen(ind[ii])
image.plot(Fdata$x,Fdata$y,1-Fdata$z,main=tmain,cex.main=3,xlab="tmax",ylab= tylb,
axes=T,col =tim.colors(20),axis.args = list(cex.axis=2),
legend.args=list( text=""),smallplot=c(0.85,0.9,0.1,0.9)
)
}
close.screen(all=TRUE);
dev.off();
}
cpl2 = matrix(list(), 6,nmts)
for (vegi in 1:6){
for (mi in 1:length(mts)){
print(sprintf('%d,%d', vegi, mi))
f4 = matrix(0,dim(fff)[1],1)
for (xi in 1:dim(fff)[1]){
tfff = matrix(0, nsss, 4)
tfff[,2] = fff[xi, 2]
tfff[,3] = fff[xi, 3]
tfff[,1] = sss
te = RVinePDF(tfff[,1:3],cvine[[vegi, mi]])
f4[xi] = mean(sss[max(te) == te])
}
tid = veg1[[vegi,mi]]$idbest
ff4 = getinvmarginal(f4, veg1[[vegi, mi]]$pars[[tid]], veg1[[vegi, mi]]$distnames[tid])
tid = heat1[[vegi,mi]]$idbest
thhh = getinvmarginal(fff[,2], heat1[[vegi, mi]]$pars[[tid]], heat1[[vegi, mi]]$distnames[tid])
tid = dry1[[vegi,mi]]$idbest
tddd = getinvmarginal(fff[,3], dry1[[vegi, mi]]$pars[[tid]], dry1[[vegi, mi]]$distnames[tid])
tf = data.frame(gpp = ff4, H = thhh, D = tddd)
tf = tf[colMeans(t(is.infinite(as.matrix(tf))))==0,]
cpl2[[vegi, mi]] = interp(tf$H, tf$D, tf$gpp, nx = 500, ny = 500)
}
}
{
nms_veg = c("forest","open forest","shrub land","paddy field","dry land","grassland")
png(filename = sprintf('./cpl_spatial_gpp.jpg'),width = 1920, height = 1080, units = "px",
bg = "transparent",  res = NA)
library(fields)
# library(RColorBrewer)
set.panel()
ind <- split.screen(c(6,nmts))
for(ii in 1:length(ind)){
vegi = ceiling(ii /nmts)
mi = mod0(ii, nmts)
print(sprintf('%d,%d', vegi, mi))
if (vegi == 1){
tmain = sprintf("month = %d", mts[mi])
} else {
tmain = "";
}
if (mi == 1){
tylb = nms_veg[vegi]
} else {
tylb = "p-pet"
}
Fdata <- cpl2[[vegi, mi]]
screen(ind[ii])
image.plot(Fdata$x,Fdata$y,1-Fdata$z,main=tmain,cex.main=3,xlab="tmax",ylab= tylb,
axes=T,col =tim.colors(20),axis.args = list(cex.axis=2),
legend.args=list( text=""),smallplot=c(0.85,0.9,0.1,0.9)
)
}
close.screen(all=TRUE);
dev.off();
}
tim.colors(20)
rev(tim.colors(20))
{
nms_veg = c("forest","open forest","shrub land","paddy field","dry land","grassland")
png(filename = sprintf('./cpl_spatial_gpp.jpg'),width = 1920, height = 1080, units = "px",
bg = "transparent",  res = NA)
library(fields)
# library(RColorBrewer)
set.panel()
ind <- split.screen(c(6,nmts))
for(ii in 1:length(ind)){
vegi = ceiling(ii /nmts)
mi = mod0(ii, nmts)
print(sprintf('%d,%d', vegi, mi))
if (vegi == 1){
tmain = sprintf("month = %d", mts[mi])
} else {
tmain = "";
}
if (mi == 1){
tylb = nms_veg[vegi]
} else {
tylb = "p-pet"
}
Fdata <- cpl2[[vegi, mi]]
screen(ind[ii])
image.plot(Fdata$x,Fdata$y,Fdata$z,main=tmain,cex.main=3,xlab="tmax",ylab= tylb,
axes=T,col =rev(tim.colors(20)),axis.args = list(cex.axis=2),
legend.args=list( text=""),smallplot=c(0.85,0.9,0.1,0.9)
)
}
close.screen(all=TRUE);
dev.off();
}
